\subsection{Анализ времени связывания для \miniKanren{}}

Цель анализа времени связывания --- указать порядок, в котором имена связываются со значениями.
Алгоритм принимает на вход программу на \miniKanren{} и данные о том, какие переменные считаются входными. 
В результате работы алгоритма каждой переменной ставится в соответствие положительное число, обозначающее время связывания этой переменной.
Мы будем называть процесс подбора чисел \emph{аннотированием}, а сам алгоритм --- алгоритмом анализа времени связывания или алгоритмом аннотирования.

Если о переменной ничего неизвестно, она аннотируется $Undef$; иначе указывается время связывания: целое положительное число.
В начале работы алгоритма известными являются переменные, указанные как входные --- они аннотируются числом $0$.
Если переменная унифицируется с константой (термом, не содержащим свободных переменных), то мы считаем её временем связывания $1$.
Если переменная унифицируется с термом, каждая свободная переменная которого аннотирована, мы аннотируем эту переменную числом $1+n$, где $n$ --- максимальная аннотация свободных переменных терма. 
Таким образом мы распространяем информацию о времени связывания на непроаннотированные переменные.

На аннотациях имеется порядок --- естественный порядок на положительных числах, при этом $Undef$ считается меньше любой числовой аннотации.
Аннотация никогда не заменяется на меньшую.
Полурешётка на аннотациях изображена на рисунке~\ref{fig:semilattice}.

\begin{figure}[htbp]
  \centering
  \begin{tikzpicture}
    \draw (0,0) node[below] {Undef};
    \draw (0,0) -- (0,.5);
    \draw (0,.5) node[above] {0};
    \draw (0,1.25) -- (0,1.75);
    \draw (0,1.75) node[above] {1};
    \draw (0,2.5) -- (0,3);
    \draw (0,3) node[above] {2};
    \draw[dotted] (0,3.75) -- (0,4.25);
  \end{tikzpicture}
  \caption{Полурешетка на аннотациях}
  \label{fig:semilattice}
\end{figure}
