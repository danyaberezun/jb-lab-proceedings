\newcommand{\valuecom}[1]{\textcolor{green!60!black}{/\!/ #1}}
\newcommand{\textdom}[1]{\mathsf{#1}}
\newcommand{\textcode}[1]{\texorpdfstring{\texttt{#1}}{#1}}
\newcommand{\kw}[1]{\textbf{\textcode{#1}}}
\newcommand{\skipc}{\kw{skip}}
\newcommand{\ite}[3]{\kw{if}\;#1\:\kw{then}\;#2\;\\ \kw{else}\;#3}
\newcommand{\iteml}[3]{
  \kw{if} \; #1\\
  \begin{array}[t]{@{}l@{}l}
    \kw{then}& \begin{array}[t]{l} #2 \end{array} \\
    \kw{else}& \begin{array}[t]{l} #3 \end{array} \\
  \end{array}
}

\newcommand{\set}[1]{\{{#1}\}}
\newcommand{\defeq}{\triangleq}
\renewcommand{\implies}{\Rightarrow}

\colorlet{colorPO}{gray!60!black}
\colorlet{colorRF}{green!60!black}
\colorlet{colorMO}{orange}
\colorlet{colorFR}{purple}
\colorlet{colorECO}{red!80!black}
\colorlet{colorSYN}{green!40!black}
\colorlet{colorHB}{blue}
\colorlet{colorPPO}{magenta}
\colorlet{colorPB}{olive}
\colorlet{colorSBRF}{olive}
\colorlet{colorRMW}{olive!70!black}
\colorlet{colorRSEQ}{blue}
\colorlet{colorSC}{violet}
\colorlet{colorPSC}{violet}
\colorlet{colorREL}{olive}
\colorlet{colorCONFLICT}{olive}
\colorlet{colorRACE}{olive}
\colorlet{colorWB}{orange!70!black}
\colorlet{colorPSC}{violet}
\colorlet{colorSCB}{violet}
\colorlet{colorDEPS}{violet}
\colorlet{colorAR}{black}

\tikzset{
   every path/.style={>=stealth},
   po/.style={->,color=colorPO,thin,shorten >=-0.5mm,shorten <=-0.5mm},
   sw/.style={->,color=colorSYN,shorten >=-0.5mm,shorten <=-0.5mm},
   rf/.style={->,color=colorRF,dashed,,shorten >=-0.5mm,shorten <=-0.5mm},
   hb/.style={->,color=colorHB,thick,shorten >=-0.5mm,shorten <=-0.5mm},
   co/.style={->,color=colorMO,dotted,very thick,shorten >=-0.5mm,shorten <=-0.5mm},
   no/.style={->,dotted,thick,shorten >=-0.5mm,shorten <=-0.5mm},
   fr/.style={->,color=colorFR,dotted,thick,shorten >=-0.5mm,shorten <=-0.5mm},
   deps/.style={->,color=colorDEPS,dotted,thick,shorten >=-0.5mm,shorten <=-0.5mm},
   rmw/.style={->,color=colorRMW,thick,shorten >=-0.5mm,shorten <=-0.5mm},
   pngexport/.style={
     external/system call/.add=
     {}
     {; convert -density 300 -transparent white "\image.pdf" "\image.png"},
     % 
     /pgf/images/external info,
     /pgf/images/include external/.code={%
       \includegraphics
       [width=\pgfexternalwidth,height=\pgfexternalheight]
       {##1.png}%
     },
   }
 }
\newcommand{\dpo}[2]{\draw[po] (#1) edge (#2)}
\newcommand{\dpopo}[2]{\draw[po] (#1) edge node[right] {$\lPO$} (#2)}
\newcommand{\drmw}[2]{\draw[rmw, bend right=20] (#1) edge node[left] {$\lRMW$} (#2)}
\newcommand{\dco}[2]{\draw[co] (#1) edge node[right] {$\lCO$} (#2)}
\newcommand{\dcoext}[4]{\draw[co, #3] (#1) edge node[#4] {$\lCO$} (#2)}
\newcommand{\drf}[2]{\draw[rf] (#1) edge node[left] {$\lRF$} (#2)}
\newcommand{\dfr}[3]{\draw[fr, #3] (#1) edge node[left] {$\lFR$}(#2)}
\newcommand{\dhb}[3]{\draw[hb, #3] (#1) edge node[right] {$\lHB$} (#2)}


%% Orders
\newcommand{\pln}{\mathtt{pln}}
\newcommand{\rlx}{\mathtt{rlx}}
\newcommand{\rel}{{\mathtt{rel}}}
\newcommand{\acq}{{\mathtt{acq}}}
\newcommand{\acqrel}{{\mathtt{acqrel}}}
\newcommand{\sco}{{\mathtt{sc}}}
% omm modes
\newcommand{\na}{{\mathtt{na}}}
\newcommand{\at}{{\mathtt{at}}}

%% Event labels
\newcommand{\rlab}[3]{{\lR}^{#1}({#2},{#3})}
\newcommand{\wlab}[3]{{\lW}^{#1}({#2},{#3})}
\newcommand{\flab}[1]{{\lF}(#1)}

\newcommand{\lR}{{\mathtt{R}}}
\newcommand{\lW}{{\mathtt{W}}}
\newcommand{\lF}{{\mathtt{F}}}
\newcommand{\lE}{{\mathtt{E}}}

%% Relations
\newcommand{\lPO}{{\color{colorPO}\mathtt{po}}}
\newcommand{\lRF}{{\color{colorRF} \mathtt{rf}}}
\newcommand{\lRMW}{{\color{colorRMW} \mathtt{rmw}}}
\newcommand{\lMO}{{\color{colorMO} \mathtt{mo}}}
\newcommand{\lMOx}{{\color{colorMO} \mathtt{mo}}_x}
\newcommand{\lMOy}{{\color{colorMO} \mathtt{mo}}_y}
\newcommand{\lCO}{{\color{colorMO} \mathtt{co}}}
\newcommand{\lCOx}{{\color{colorMO} \mathtt{co}}_x}
\newcommand{\lCOy}{{\color{colorMO} \mathtt{co}}_y}
\newcommand{\lFR}{{\color{colorFR} \mathtt{fr}}}
\newcommand{\lFRx}{{\color{colorFR} \mathtt{rb}}_x}
\newcommand{\lFRy}{{\color{colorFR} \mathtt{rb}}_y}
\newcommand{\lECO}{{\color{colorECO} \mathtt{eco}}}
\newcommand{\lSW}{{\color{colorSYN}\mathtt{sw}}}
\newcommand{\lHB}{{\color{colorHB}\mathtt{hb}}}
\newcommand{\lHBO}{{\color{olive}\mathtt{hbo}}}
\newcommand{\lDOB}{{\mathtt{dob}}}
\newcommand{\lBOB}{{\mathtt{bob}}}
\newcommand{\lAOB}{{\mathtt{aob}}}
\newcommand{\lOBS}{{\mathtt{obs}}}
\newcommand{\lEORD}{{\mathtt{eord}}}
\newcommand{\lTORD}{{\mathtt{tord}}}
\newcommand{\lSC}{{\mathtt{sc}}}
\newcommand{\lAR}{{\color{colorAR} \mathtt{ar}}}

\newcommand{\lSCB}{{\color{colorSCB} \mathtt{scb}}}
\newcommand{\lPSC}{{\color{colorPSC} \mathtt{psc}}}
\newcommand{\lPSCB}{\lPSC_{\rm base}}
\newcommand{\lPSCF}{\lPSC_\lF}

\newcommand{\lDEPS}{{{\color{colorDEPS}\mathtt{deps}}}}
\newcommand{\lCTRL}{{{\color{colorDEPS}\mathtt{ctrl}}}}
\newcommand{\lCTRLISYNC}{{{\color{colorDEPS}\mathtt{ctrl_{isync}}}}}
\newcommand{\lDATA}{{{\color{colorDEPS}\mathtt{data}}}}
\newcommand{\lADDR}{{{\color{colorDEPS}\mathtt{addr}}}}
\newcommand{\lCASDEP}{{{\color{colorDEPS}\mathtt{casdep}}}}

\newcommand{\lmakeE}[1]{#1\mathtt{e}}
\newcommand{\lRFE}{\lmakeE{\lRF}}
\newcommand{\lCOE}{\lmakeE{\lCO}}
\newcommand{\lFRE}{\lmakeE{\lFR}}
\newcommand{\lMOE}{\lmakeE{\lMO}}
\newcommand{\lmakeI}[1]{#1\mathtt{i}}
\newcommand{\lRFI}{\lmakeI{\lRF}}
\newcommand{\lCOI}{\lmakeI{\lCO}}
\newcommand{\lFRI}{\lmakeI{\lFR}}

\newcommand{\Tid}{\mathsf{Tid}}
\newcommand{\Loc}{\mathsf{Loc}}
\newcommand{\Val}{\mathsf{Val}}
\newcommand{\Init}{\mathsf{Init}}
\newcommand{\Lab}{\mathsf{Lab}}
\newcommand{\Mod}{\mathsf{Mod}}
\newcommand{\Modr}{\mathsf{Mod}_{\lR}}
\newcommand{\Modw}{\mathsf{Mod}_{\lW}}
\newcommand{\Modf}{\mathsf{Mod}_{\lF}}
\newcommand{\Modrmw}{\mathsf{Mod}_{\lU}}


% example rels
\newcommand{\exX}{\mathtt{x}}
\newcommand{\exY}{\mathtt{y}}

\definecolor{StringRed}{rgb}{.637,0.082,0.082}
\definecolor{CommentGreen}{rgb}{0.0,0.55,0.3}
\definecolor{KeywordBlue}{rgb}{0.0,0.3,0.55}
\definecolor{LinkColor}{rgb}{0.55,0.0,0.3}
\definecolor{CiteColor}{rgb}{0.55,0.0,0.3}
\definecolor{HighlightColor}{rgb}{0.0,0.0,0.0}

\definecolor{grey}{rgb}{0.5,0.5,0.5}
\definecolor{red}{rgb}{1,0,0}
\definecolor{darkgreen}{rgb}{0.0,0.7,0.0}

\hypersetup{%
  linktocpage=true, pdfstartview=FitV,
  breaklinks=true, pageanchor=true, pdfpagemode=UseOutlines,
  plainpages=false, bookmarksnumbered, bookmarksopen=true, bookmarksopenlevel=3,
  hypertexnames=true, pdfhighlight=/O,
}


\newcommand{\commentNonempty}[1]{
  \ifx\\#1\\
    {}
  \else
    \valuecom{#1}
  \fi
  }
\newcommand{\readInst}[4]{#1 \;:=\;[#2]^{#4}; \commentNonempty{#3}}
\newcommand{\fenceInst}[1]{\mathtt{fence}^{#1};}
\newcommand{\writeInst}[3]{[#1]^{#3}\;:=\;#2;}
\newcommand{\casInstSC}[3]{\mathtt{CAS^{\sco, \sco}_{\sco}(#1, #2, #3)};}
\newcommand{\assignInst}[2]{#1\;:=\;#2;}
\newcommand{\exchangeInstSC}[2]{\mathtt{exchange^{\sco}(#1, #2)};}
\newcommand{\term}[1]{\emph{#1}}



\newcommand{\Wrlx}{\lW^{\rlx}}
\newcommand{\Rrlx}{\lR^{\rlx}}
\newcommand{\Wsc}{\lW^{\sco}}
\newcommand{\Rsc}{\lR^{\sco}}
\newcommand{\Fa}{\lF^{\acq}}
\newcommand{\Fr}{\lF^{\rel}}
\newcommand{\Far}{\lF^{\acqrel}}
\newcommand{\ar}{\ensuremath{ar}}
\newcommand{\IMM}{\mathtt{IMM}}
\newcommand{\OMM}{\mathtt{OCaml}\allowbreak \mathtt{MM}}
\newcommand{\todo}[1]{\textbf{\Large TODO: \textcolor{red}{#1}}}
\newcommand{\strongereq}{\sqsupseteq}
\newcommand{\defin}[1]{\textit{#1}}
\newcommand{\imm}{|_{imm}}

% \declaretheorem[name=Теорема,style=default,numberwithin=section]{thm}
% \declaretheorem[name=Лемма,style=default,numberwithin=section]{lem}
% \declaretheorem[name=Определение,style=default,sibling=thm]{mydefinition}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:
